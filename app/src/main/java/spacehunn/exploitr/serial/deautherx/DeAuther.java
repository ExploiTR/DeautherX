package spacehunn.exploitr.serial.deautherx;

import android.app.Application;
import android.os.Environment;

import java.io.File;
import java.io.IOException;

public class DeAuther extends Application {

    Process process;

    @SuppressWarnings("ResultOfMethodCallIgnored")
    public void onCreate() {
        super.onCreate();

        if (isExternalStorageWritable()) {

            File appDirectory = new File(Environment.getExternalStorageDirectory() + "/DeAutherX");
            File logDirectory = new File(appDirectory + "/log");
            File logFile = new File(logDirectory, "logcat" + System.currentTimeMillis() + ".txt");

            if (!appDirectory.exists()) {
                appDirectory.mkdir();
            }

            if (!logDirectory.exists()) {
                logDirectory.mkdir();
            }

            try {
                process = Runtime.getRuntime().exec("logcat -c");
                process.waitFor();
                process = Runtime.getRuntime().exec("logcat -f " + logFile);
            } catch (IOException | InterruptedException e) {
                e.printStackTrace();
            }

        }
    }

    @Override
    public void onTerminate() {
        if (process != null) {
            process.destroy();
        }
        super.onTerminate();
    }

    public boolean isExternalStorageWritable() {
        String state = Environment.getExternalStorageState();
        return Environment.MEDIA_MOUNTED.equals(state);
    }

}
